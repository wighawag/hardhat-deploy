<h1> hardhat-deploy</h1>

_A [Hardhat](https://hardhat.org) Plugin For Replicable Deployments And Easy Testing_

> **Note: This is the documentation for hardhat-deploy v2 that works with [hardhat v3](https://hardhat.org/hardhat3-alpha)**
>
> Documentation for hardhat-deploy v1 can be found on the [v1 branch](https://github.com/wighawag/hardhat-deploy/tree/v1#readme)

hardhat-deploy make it easy for you to deploy your conracts across many chains.

The version 2 is a full rewrite that has been already used in production for several years. It does not support yet all the features of version 1 but is fully modular and it is thus much easier to contribute to new deployment mechanism.

Under the hood, hardhat-deploy uses [rocketh](https://github.com/wighawag/rocketh) a framework agnostic system that provide a minimal api to save and load deployment.

Everything else is handled by external module. For example `@rocketh/deploy` give you a deploy function that you can use to deploy contracts.
But you can provide your own module for advanced use case.

There are already a few like `@rocketh/proxy` to deploy proxy declaratively like in hardhat-deploy

> **A complete dev template using hardhat-deploy is available here**: https://github.com/wighawag/template-ethereum-contracts

## Features

- chain configuration export (via @rocketh/export)
  (listing deployed contracts' addresses and their abis (useful for web apps))
- library linking at the time of deployment.
- deterministic deployment across networks.
- support for specific deploy script per network (L1 vs L2 for example)
- deployment dependency system (allowing you to only deploy what is needed).
- deployment retrying (by saving pending tx): so you can feel confident when making a deployment that you can always recover.
- contains helpers to read and execute transaction on deployed contract referring to them by name.
- save metadata of deployed contract so they can always be fully verified, via sourcify or etherscan.
- ability to submit contract source to etherscan and sourcify for verification at any time. (Because hardhat-deploy will save all the necessary info, it can be executed at any time.)
- support hardhat's fork feature so deployment can be accessed even when run through fork.
- declarative proxy deployment with ability to upgrade them transparently, only if code changes.
- support HRC (Hot Contract Replacement) via special proxy mechanism

## Migrating from hardhat-deploy v1

in v1 you would create a deploy file like this:

```typescript
// deploy/00_deploy_my_contract.js
// export a function that get passed the Hardhat runtime environment
module.exports = async ({getNamedAccounts, deployments}) => {
	const {deploy} = deployments;
	const {deployer} = await getNamedAccounts();
	await deploy('MyContract', {
		from: deployer,
		args: ['Hello'],
		log: true,
	});
};
// add tags and dependencies
module.exports.tags = ['MyContract'];
```

in v2 you will do this instead:

```typescript
// deploy/00_deploy_my_contract.js
// execute is needed to register your script
import {execute} from 'rocketh';
// here we add the `@rocketh/deploy` extension that let you use the deploy function (hardhat-deploy v2 is fully modular)
import '@rocketh/deploy';
// here we import the context, the convention is to import it from a file named `_context.ts`
// it contains the configuration like artifacts and named accounts
// see bellow for an example
import {context} from './_context.js';

export default execute(
	// we pass the context to the "execute" function
	// it will transform it while keeping type safety (in particular namedAccounts)
	context,
	// then you pass in your function that can do whatever it wants
	async ({deploy, namedAccounts, artifacts}) => {
		const {deployer} = namedAccounts;

		await deploy('MyContract', {
			account: deployer,
			artifact: artifacts.GreetingsRegistry,
			args: [''], // type-safe checking
		});
	},
	// finally you can pass tags and dependencies
	{tags: ['MyContract', 'MyContract_deploy']}
);
```

```typescript
//deploy/_context.ts
// typed artifacts automatically generated by hardhat-deploy
import artifacts from '../generated/artifacts.js';
import '@rocketh/signer';

export const context = {
	// this define the named-accounts
	// these are transformed into addresses
	// so when your deploy function get executed it have access to them while keeping type-safety
	accounts: {
		deployer: {
			default: 0,
		},
	},
	// the artifacts are viem compatible and you can use them to have type-safe calls or deployments
	artifacts,
} as const;
```
